<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>5G88 Login</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" type="image/png" href="https://i.imgur.com/uGijtpF.png" />
  <style>
    html,body{height:100%} body{
      margin:0; font-family:system-ui,Segoe UI,Inter,Arial;
      background: url('https://i.imgur.com/UCZqSrT.png') center/cover no-repeat fixed;
      color:#fff; display:grid; place-items:center;
    }
    .login-box{width:460px; padding:34px 24px; text-align:center;
      border:2px solid gold; border-radius:12px; background:rgba(0,0,0,.4);
      box-shadow:0 0 12px rgba(255,215,0,.6)}
    .login-btn{display:inline-block; margin-top:8px; padding:10px 20px;
      border:2px solid gold; background:#FFD700; color:#000; font-size:18px;
      border-radius:8px; cursor:pointer}
    .login-btn:disabled{opacity:.6; cursor:not-allowed}
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
  <div class="login-box">
    <img src="https://i.imgur.com/QrxyBjc.png" alt="5G88" style="max-width:360px; display:block; margin:0 auto 20px">
    <button id="googleLoginBtn" class="login-btn">Login with Google</button>
    <p id="msg" style="color:#ffd700;margin:12px 0 0;min-height:20px"></p>
  </div>

<script>
(() => {
  // === CONFIG (punyamu) ===
  const firebaseConfig = {
    apiKey: "AIzaSyCZ9zUxDf3V9TvI3vOdgeZD7pLE4IuPrOE",
    authDomain: "logins-d615f.firebaseapp.com",
    databaseURL: "https://logins-d615f-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "logins-d615f",
    storageBucket: "logins-d615f.appspot.com",
    messagingSenderId: "580872784703",
    appId: "1:580872784703:web:07957551c3214f3d32618a"
  };

  // ✅ SAME-ORIGIN redirect (HAPUS hardcode domain lain)
  const REDIRECT_URL = location.origin + '/';             // <— DIUBAH

  // Init
  if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db   = firebase.database();

  const $ = s => document.querySelector(s);
  const btn = $('#googleLoginBtn');
  const msg = $('#msg');

  const sanitizeEmailKey = (email) => String(email||'').toLowerCase().replace(/[.#$[\]/]/g,'_');
  const fmtTime = (d=new Date())=>{
    const p=n=>String(n).padStart(2,'0');
    return `${d.getFullYear()}-${p(d.getMonth()+1)}-${p(d.getDate())} ${p(d.getHours())}:${p(d.getMinutes())}:${p(d.getSeconds())}`;
  };

  async function signInWithGoogle(){
    btn.disabled = true; msg.textContent = 'Signing in...';
    try{
      await auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);  // <— DITAMBAH (opsional)
      const provider = new firebase.auth.GoogleAuthProvider();
      const { user } = await auth.signInWithPopup(provider);
      if (!user) throw new Error('User not found');

      // blocklist check
      const key = sanitizeEmailKey(user.email);
      const blk = await db.ref(`logins/blocked_users/${key}`).get();
      if (blk.val() === true){
        await auth.signOut();
        msg.textContent = 'Access denied. Contact 5G88.';
        btn.disabled = false;
        return;
      }

      // simpan jejak
      await db.ref(`logins/${key}`).set({
        name: user.displayName || '',
        email: user.email || '',
        loginAt: fmtTime()
      });

      // kirim profil via query (dipakai main page buat UI)
      const qs = new URLSearchParams({
        name:  user.displayName || '',
        email: user.email || '',
        photo: user.photoURL || ''
      }).toString();

      // ✅ pakai replace agar Back tidak kembali ke login
      location.replace(`${REDIRECT_URL}?${qs}`);           // <— DIUBAH
    }catch(e){
      console.error(e);
      msg.textContent =
        e?.code === 'auth/popup-blocked' ? 'Popup diblokir. Izinkan popup.'
      : e?.code === 'auth/unauthorized-domain' ? 'Domain belum diizinkan di Firebase Auth.'
      : 'Login gagal. Coba lagi.';
      btn.disabled = false;
    }
  }

  btn.addEventListener('click', signInWithGoogle);
})();
</script>
</body>
</html>
