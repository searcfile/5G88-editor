<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>5G88 Login</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" type="image/png" href="https://i.imgur.com/uGijtpF.png" />
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    html,body{height:100%}
    body{
      margin:0;background:url('https://i.imgur.com/UCZqSrT.png') center/cover no-repeat fixed;
      color:#fff;font-family:system-ui,Segoe UI,Inter,Arial;display:grid;place-items:center;
    }
    .login-box{
      width:460px;padding:34px 24px;text-align:center;border:2px solid gold;border-radius:12px;
      background:rgba(0,0,0,.4);box-shadow:0 0 12px rgba(255,215,0,.6);
      transition:transform .25s ease, box-shadow .25s ease
    }
    .login-box:hover{transform:scale(1.02);box-shadow:0 0 18px rgba(255,215,0,.9)}
    .login-box img{max-width:360px;display:block;margin:0 auto 20px}
    .login-btn{
      display:inline-block;margin-top:8px;padding:10px 20px;border:2px solid gold;background:#FFD700;
      color:#000;font-size:18px;border-radius:8px;cursor:pointer
    }
    .login-btn:hover{filter:brightness(1.05)}
    .login-btn:disabled{opacity:.6;cursor:not-allowed}
    #msg{color:#ffd700;margin-top:12px;min-height:20px}
    /* popup welcome (opsional) */
    .popup-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:9999}
    .popup-box{border:2px solid gold;border-radius:12px;padding:40px 20px 30px;text-align:center;position:relative;width:550px;min-height:320px;box-shadow:0 0 10px rgba(255,215,0,.7);background:rgba(0,0,0,.4);backdrop-filter:blur(10px)}
    .popup-close{position:absolute;top:10px;right:10px;background:#111;border:2px solid gold;border-radius:6px;color:gold;font-size:16px;cursor:pointer;padding:2px 8px}
    .popup-title{font-size:26px;font-weight:700;margin:6px 0 12px;color:gold}
    .popup-btn{background:transparent;border:2px solid gold;color:gold;padding:8px 16px;border-radius:6px;cursor:pointer}
  </style>
</head>
<body>

  <!-- Popup (opsional) -->
  <div class="popup-overlay" id="popup">
    <div class="popup-box" id="popupBox">
      <button class="popup-close" onclick="closePopup()">X</button>
      <p class="popup-title">Welcome to 5G88!</p>
      <img src="https://api.5g88.homes/media/LOADING_GIF.webp" alt="5G88" style="max-width:220px;margin:10px auto 16px;display:block">
      <button class="popup-btn" onclick="closePopup()">OK</button>
    </div>
  </div>

  <div class="login-box">
    <img src="https://i.imgur.com/QrxyBjc.png" alt="5G88">
    <button id="googleLoginBtn" class="login-btn">Login with Google</button>
    <p id="msg"></p>
  </div>

<script>
(() => {
  /* ========= KONFIG ========= */
  // Alamat homepage (domain utama)
  const HOME_URL = "https://5g88-main.vercel.app/";   // <-- ganti kalau beda

  // Firebase project untuk LOGIN
  const firebaseConfig = {
    apiKey: "AIzaSyCZ9zUxDf3V9TvI3vOdgeZD7pLE4IuPrOE",
    authDomain: "logins-d615f.firebaseapp.com",
    databaseURL: "https://logins-d615f-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "logins-d615f",
    storageBucket: "logins-d615f.appspot.com",
    messagingSenderId: "580872784703",
    appId: "1:580872784703:web:07957551c3214f3d32618a"
  };

  /* ========= INIT ========= */
  if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db   = firebase.database();

  const $ = s => document.querySelector(s);
  const btn = $('#googleLoginBtn');
  const msgEl = $('#msg');              // opsional, kalau ada <div id="msg"></div>

  const setMsg = (t) => { if (msgEl) msgEl.textContent = t; };
  const p2 = n => String(n).padStart(2,'0');
  const fmtTime = (d=new Date()) => `${d.getFullYear()}-${p2(d.getMonth()+1)}-${p2(d.getDate())} ${p2(d.getHours())}:${p2(d.getMinutes())}:${p2(d.getSeconds())}`;
  const keyOf = (email) => String(email||'').toLowerCase().replace(/[.#$[\]/]/g,'_');

  // Tutup popup welcome, bila ada
  function initPopup(){
    const overlay = $('#popup');
    if (!overlay) return;
    window.closePopup = () => overlay.style.display = 'none';
    window.addEventListener('click', (e)=>{ if (e.target === overlay) closePopup(); });
  }

  /* ========= REDIRECT DENGAN PROFIL ========= */
  function goHomeWithProfile(user){
    const qs = new URLSearchParams({
      name:  user.displayName || '',
      email: user.email || '',
      photo: user.photoURL || ''
    }).toString();
    // Pakai replace agar tidak kembali ke login saat Back
    location.replace(`${HOME_URL}?${qs}`);
  }

  /* ========= LOGIN ========= */
  async function signInWithGoogle(){
    if (btn) btn.disabled = true;
    setMsg('Signing in...');
    try{
      await auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);
      const provider = new firebase.auth.GoogleAuthProvider();
      const { user } = await auth.signInWithPopup(provider);
      if(!user) throw new Error('User not found');

      // cek blocklist
      const key = keyOf(user.email);
      const blocked = await db.ref(`logins/blocked_users/${key}`).get();
      if (blocked.val() === true){
        await auth.signOut();
        setMsg('Access denied. Contact 5G88.');
        if (btn) btn.disabled = false;
        return;
      }

      // catat login
      await db.ref(`logins/${key}`).set({
        name: user.displayName || '',
        email: user.email || '',
        loginAt: fmtTime()
      });

      // kirim profil â†’ homepage akan simpan ke localStorage & bersihkan URL
      goHomeWithProfile(user);

    }catch(e){
      console.error(e);
      const m =
        e?.code === 'auth/popup-blocked'       ? 'Popup diblokir. Izinkan popup.'
      : e?.code === 'auth/unauthorized-domain' ? 'Domain ini belum diizinkan di Firebase Auth.'
      : e?.code === 'auth/cancelled-popup-request' ? 'Popup login dibatalkan. Coba lagi.'
      : e?.code === 'auth/popup-closed-by-user' ? 'Popup ditutup sebelum selesai.'
      : 'Login gagal. Coba lagi.';
      setMsg(m);
      if (btn) btn.disabled = false;
    }
  }

  /* ========= BOOT ========= */
  document.addEventListener('DOMContentLoaded', () => {
    initPopup();

    // Jika user sudah pernah login di domain ini, langsung redirect
    auth.onAuthStateChanged((user) => {
      if (user) goHomeWithProfile(user);
    });

    btn?.addEventListener('click', signInWithGoogle);
  });
})();
</script>
</body>
</html>
