<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="https://i.imgur.com/uGijtpF.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Home | 5G88</title>
  <style>
  * {margin: 0;padding: 0;box-sizing: border-box;font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';}
  body {background-color: #000;color: #fff;overflow-x: hidden;display: flex;flex-direction: column;height: 100vh;-ms-overflow-style: none;scrollbar-width: none;}body::-webkit-scrollbar{display: none;} html{-ms-overflow-style: none;scrollbar-width: none;}html::-webkit-scrollbar{display: none;} 
  .sidebar-overlay {position: fixed;top: 0;left: 0;width: 100vw;height: 100vh;background: rgba(0, 0, 0, 0.5);display: none;z-index: 999;}
  .sidebar {position: fixed;top: 0;left: -260px;width: 260px;height: 100vh;background: #111;padding: 20px;transition: 0.3s;z-index: 1002;}
  .sidebar.active {left: 0;}.sidebar-overlay.active {display: block;}.sidebar h2 {color: white;margin-bottom: 10px;border-bottom:3px solid white;}
  .sidebar a {display: block;margin: 10px 0;color: gold;text-decoration: none;font-size: 14px;font-weight: bold;border-radius: 6px;transition: background 0.2s;padding: 4px 8px;gap: 5px;white-space: nowrap;}
  .sidebar a:hover {background: gold;color: #111;}
  .close-btn {background: transparent;font-weight: 700;color: #dbb900;padding: 3px 6px;font-size: 12px;cursor: pointer;border-radius: 6px;margin-bottom: 20px;border: 1px solid #ffe34d;}
  .header {position: fixed;width: 100%;z-index: 1003;height: 55px;background: #000;display: flex;justify-content: center;align-items: center;padding: 0 20px;top: 0;left: 0;}.close-btn:hover {background:transparent;color:#ffe34d;transition: color 0.2s;}.close-btn:active {background:transparent;color:gold;transition: color 0.2s;}
  .header img {position: absolute;max-height: 40px;top: 5px;}
  .user-info {position: absolute;right: 5px;top: 50%;transform: translateY(-50%);display: flex;align-items: center;gap: 10px;white-space: nowrap;flex-wrap: nowrap;transition: 0.3s;}
  .user-text {gap: 10px;display: flex;align-items: center;}
  .user-details {display: flex;flex-direction: column;align-items: flex-end;}
  .date-time {color: white;font-size: 14px;white-space: nowrap;transition: color 0.3s;}
  .container {transition: margin-left 0.3s ease;position: relative;}
  .container.shrink { margin-left: 260px;}
  .menu-icon {position: absolute;top: 5px;left: 5px;font-size: 28px;color: rgba(255, 255, 255, 0.65);cursor: pointer;z-index: 1100;transition: color 0.3s;}.menu-icon:hover {color: #ffe34d;transition: color 0.2s;}.active-menu-icon {color: gold;transition: all 0.2s ease;}.menu-icon:active {color: #dbb900;transition: color 0.2s;}
  .menu-img {width: 20px;height: 20px;vertical-align: middle;margin-right: 8px;border-radius: 4px;}
  @media (max-width: 600px) {
  .container.shrink {margin-left: 0;}}
  html, body {height: 100%;}
  #pageFrame {width: 100%;height: calc(100vh - 95px); border: none;}
  .tab-bar {position: relative;transition: all 0.2s ease;width: 100%;height: 40px;background: black;display: flex;align-items: center;gap: 0;z-index: 1000;justify-content: flex-start;white-space: nowrap; margin-top: 55px;overflow-x: auto;overflow-y: hidden; white-space: nowrap;-ms-overflow-style: none;scrollbar-width: none;scroll-behavior: smooth;}
  .tab-bar::-webkit-scrollbar {display: none;}
  .tab {background: gold;color: #111;padding: 5px 12px;border-radius: 8px;font-weight: bold;display: flex;align-items: center;gap: 2px;
      cursor: default;transition: background-color 0.3s ease;white-space: nowrap;box-shadow: 0 2px 0 rgba(255, 255, 255, 0.04);transition: all 0.3s ease;} 
  .tab .close-tab {background: rgba(255,255,255,0.04);color: gold;border: none;font-size: 18px !important;border-radius: 50%;cursor: pointer;width: 20px;height: 20px;display: flex;align-items: center;justify-content: center;transition: transform .2s, color .2s !important;}
  .tab:hover {color: #ffe34d !important;font-weight: bold !important;transition: all 0.3s ease;}
  .active-tab {background-color: #141414 !important;color: gold !important;font-weight: bold;transition: all 0.3s ease;}.tab:active {color: #dbb900!important;font-weight: bold !important;transition: all 0.3s ease;}
  .floating-logo {position: fixed;top: 5px;left: 50%;transform: translateX(-50%);height: 40px;z-index: 1103;}.floating-logo.shrink {transform: translateX(calc(-50% + 130px));}
  .header.shrink {margin-left: 260px;transition: margin-left 0.3s;}
  .tab-bar.shrink {margin-left: 260px;transition: margin-left 0.3s;}
  #logoutBtn {display: flex;align-items: center;justify-content: center;height:32px;line-height: 1;gap: 2px;background-color: #141414;color: rgba(255,255,255,0.85);padding: 5px 10px;border-radius: 6px;cursor: pointer;width: 100%;box-shadow: 0 2px 0 rgba(255, 255, 255, 0.04);transition: all 0.3s ease;border: 1px solid #424242;font-size: 14px;}#logoutBtn:hover {color: #ffe34d;transition: all 0.3s ease;border: 1px solid #ffe34d;}#logoutBtn:active {color: #dbb900;transition: all 0.3s ease;border: 1px solid #dbb900;background-color: #141414;}
  #notifTooltip {opacity: 0;transition: opacity 0.2s ease;}
  #notifButton:hover #notifTooltip {display: block !important;opacity: 1;z-index: 10000;}
 .user-dropdown {position: relative;display: inline-block;}
 .user-button {display: flex;align-items: center;justify-content: center;line-height: 1;gap: 5px;background-color: #141414;color: rgba(255,255,255,0.85);border:1px solid #424242;border-radius: 6px;padding: 0px 15px;font-size: 14px;cursor: pointer;white-space: nowrap;height: 32px;transition: all 0.3s ease;box-shadow: 0 2px 0 rgba(255, 255, 255, 0.04);}
 .user-button:hover {border:1px solid #ffe34d;background-color: #141414;color: #ffe34d;}.user-button:active {border: 1px solid gold;background-color: #141414;color: gold;}

 .dropdown-content {
  display: none;
  position: absolute;
  background-color: #1f1f1f;
  min-width: 220px;
  border: 1px solid #424242;
  border-radius: 6px;
  box-shadow: 0px 8px 16px rgba(0,0,0,0.3);
  padding: 10px;
  z-index: 1;
  color: rgba(255,255,255,0.85);
  top: 110%;
  right: 0;
  left: auto;
  transform: none;
  font-size: 14px;
  transition: all 0.2s ease !important;
}
.dropdown-content {opacity: 0;visibility: hidden;transition: opacity 0.3s ease, visibility 0.3s ease;}
.user-dropdown:hover .dropdown-content {opacity: 1;visibility: visible;display: block;}
  .live-chat-button {
  color: rgba(255,255,255,0.65);
  border: none;
  font-size: 15px;
  cursor: pointer;
  transition: color 0.3s;
  display: flex;
  align-items: center;
  gap: 3px;
  background: transparent;
  position: relative;
}
.live-chat-button:hover {color: rgba(255,255,255,0.85);background: transparent;transition: color 0.3s;}.live-chat-button:active {color: #8d8d8d !important;background: transparent;}
.live-chat-button.active-livechat,
.live-chat-button.active-linkdownload,
.live-chat-button.active-gamelog {
  background: transparent;
  color: gold;
}
.dropdown-wrapper {
  position: relative;
  display: inline-block;
}

.dropdown-links {
  display: none;
  position: fixed;
  top: 60px;
  z-index: 10000;
  background-color: #1f1f1f;
  border: 1px solid #424242;
  border-radius: 6px;
  min-width: 180px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.4);
  padding: 6px 0;
  transition: color 0.3s;
}
.check-icon {
  flex-shrink: 0;
  margin-left: 10px;
  width: 16px;
  height: 16px;
  color: transparent;
  transition: color 0.3s;
  display: none;
}
a.tab-open .check-icon {
  color: gold;
}
.dropdown-links a {
  display: flex; /* ✅ ubah dari block ke flex */
  justify-content: space-between; /* ✅ label kiri, icon kanan */
  align-items: center;
  padding: 8px 16px;
  color: white;
  text-decoration: none;
  font-size: 14px;
  transition: color 0.3s;
  gap: 10px; /* opsional jarak label dengan icon */
}

.dropdown-links a:hover {
  background: transparent;
  color:  #ffe34d;
  transition: color 0.3s;
}
.dropdown-links a:active {
  background: transparent;
  color: #dbb900!important;
}
#gameLogBtn.active-gamelog {
  color: gold;
  background: transparent;
  transition: all 0.2s ease;
}
 .dot-icon {
  position: absolute;
  top: -6px;
  right: -13px;
  display: none;
  z-index: 2;
}
#dropdownContent .menu-username{ display:none !important; }

/* Tombol username di dropdown – default: sembunyi (desktop) */
#dropdownContent .menu-user-btn{
  display:none;                 /* <-- penting: hidden di desktop */
  width:100%;
  height:32px;
  /* jangan set display:flex di sini */
  align-items:center;
  justify-content:center;
  gap:6px;
  line-height:1;
  background-color:#141414;
  color:rgba(255,255,255,0.85);
  border:1px solid #424242;
  border-radius:6px;
  padding:0 12px;
  cursor:default; /* info only */
  font-size:14px;
  transition:all .3s ease;
  box-shadow:0 2px 0 rgba(255,255,255,0.04);
  margin-bottom:8px;
}
#dropdownContent .menu-user-btn:hover{
  border-color:#ffe34d; color:#ffe34d;
}

/* Muncul HANYA di mobile */
@media (max-width: 768px){
  /* nav jadi icon-only */
  .live-chat-button .btn-label{ display:none; }

  /* sembunyikan logo & jam */
  .floating-logo{ display:none !important; }
  .date-time{ display:none !important; }

  /* tombol user (kanan) icon-only */
  #userNameText{ display:none !important; }

  /* tampilkan tombol username mobile */
  #dropdownContent .menu-user-btn{ display:flex !important; }

  /* tinggi bar tetap */
  .header{ height:55px; }
  .tab-bar{ margin-top:55px; }
}
  .dragging {opacity: 0.5;transform: scale(1.05);z-index: 999;}
  #cpModal{position:fixed;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(3px);display:none;align-items:center;justify-content:center;z-index:10050}
  #cpDialog{width:min(650px,92vw);background:#1f1f1f;border:1px solid gold;border-radius:12px;box-shadow:0 0 14px rgba(255, 215, 0, .6);overflow:hidden;transition: all 0.3s ease;animation: zoomIn .25s ease forwards;}
  #cpHead{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;border-bottom:1px solid #2a2a2a;background:#141414}
  #cpTitle{color:gold;font-weight:700;font-size:15px}
  #cpClose{background:transparent;border:0;color:rgba(255,255,255,0.65);font-size:20px;cursor:pointer;line-height:1;transition:transform .2s,color .2s}
  #cpClose:hover{transform:scale(1.15);color:#fff}
  #cpBody{padding:12px 14px}
  .cp-group{display:flex;flex-direction:column;gap:6px;margin-bottom:10px}
  .cp-label{font-size:13px;color:rgba(255,255,255,.85)}
  .cp-input{background:#141414;border:1px solid #424242;border-radius:6px;color:#fff;padding:8px 10px;font-size:14px;outline:none}
  .cp-input:focus{border-color:gold}
  #cpFoot{display:flex;gap:8px;justify-content:flex-end;padding:10px 14px;border-top:1px solid #2a2a2a;background:#141414}
  .cp-btn{min-width:88px;height:34px;border-radius:6px;border:1px solid #424242;background:#1f1f1f;color:#fff;cursor:pointer;font-size:14px;transition: all 0.3s ease;}
  .cp-btn:hover{border-color:#ffe34d;color:#ffe34d}.cp-btn:active{border-color:#dbb900;color:#dbb900}
  .cp-btn.primary{border-color:gold;color:#000;background:gold;font-weight:500}
  .cp-btn.primary:hover{background:#ffe34d;}.cp-btn.primary:active{background:#dbb900;}
  .cp-hint{font-size:12px;color:#aaa;margin-top:-4px;margin-bottom:8px}
  .cp-error{font-size:12px;color:#ff6b6b;display:none;margin:-2px 0 8px}
  .cp-ok{font-size:12px;color:#7CFC7C;display:none;margin:-2px 0 8px}
  .btn-cpw{display:none;width:100%;height:32px;display:flex;align-items:center;justify-content:center;gap:6px;line-height:1;background-color:#141414;color:rgba(255,255,255,0.85);border:1px solid #424242;border-radius:6px;padding:0 12px;cursor:pointer;font-size:14px;transition:all .3s ease;box-shadow:0 2px 0 rgba(255,255,255,0.04);margin-bottom:8px;}
  .btn-cpw:hover{border:1px solid #ffe34d; color:#ffe34d;}.btn-cpw:active{border:1px solid #dbb900; color:#dbb900;}
  /* Empty state */
#mainContainer { position: relative; }          /* container harus relative */

.empty-state{
  position: absolute; inset: 0;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  gap: 12px; text-align: center;
  color: rgba(255,255,255,.7);
  pointer-events: none;                         /* biar tidak ganggu klik header/menu */
  z-index: 10;                                   /* loader kamu (z-index 1000) tetap di atas */
}
.empty-state .empty-title{ font-size: 16px; color: rgba(255,255,255,.85); }
.empty-state .empty-icon{ opacity: .6 }
.empty-state .empty-desc{ font-size: 14px; opacity: .8 }

.empty-state.hidden{ display: none; }
  </style>
</head>
<body>
  <div class="sidebar-overlay" id="overlay"></div>
  <div class="sidebar" id="sidebar">
    <button class="close-btn" onclick="closeSidebar()">✕ Close</button>
    <h2>Menu list</h2>
    <a href="#" onclick="addTab('LIVE CHAT', 'https://searcfile.github.io/5g88-php/userlivechatphp/')">
      <img src="https://i.imgur.com/WDjH3BZ.png" alt="icon" class="menu-img"> LIVE CHAT
    </a>
    <a href="#" onclick="addTab('MEGA888', 'https://searcfile.github.io/5G88-editor/mega888/')">
      <img src="https://i.imgur.com/WDjH3BZ.png" alt="icon" class="menu-img"> MEGA888
    </a>
    <a href="#" onclick="addTab('PUSSY888', 'https://searcfile.github.io/5G88-editor/pussy888/')">
      <img src="https://i.imgur.com/WDjH3BZ.png" alt="icon" class="menu-img"> PUSSY888
    </a>
    <a href="#" onclick="addTab('918KISS', 'https://searcfile.github.io/5G88-editor/918kiss/')">
      <img src="https://i.imgur.com/WDjH3BZ.png" alt="icon" class="menu-img"> 918KISS
    </a>
    <a href="#" onclick="addTab('SCR888H5', 'https://searcfile.github.io/5G88-editor/scr888h5/')">
      <img src="https://i.imgur.com/WDjH3BZ.png" alt="icon" class="menu-img"> SCR888H5
    </a>
    <a href="#" onclick="addTab('LOGO GAME', 'https://searcfile.github.io/5G88-editor/logogame/')">
      <img src="https://i.imgur.com/WDjH3BZ.png" alt="icon" class="menu-img"> LOGO GAME
    </a>
    <a href="#" onclick="addTab('TIPS GAME', 'https://searcfile.github.io/5G88-editor/tipsgenerate/')">
      <img src="https://i.imgur.com/WDjH3BZ.png" alt="icon" class="menu-img"> TIPS GAME
    </a>
    <a href="#" onclick="addTab('FIND GAME', 'https://searcfile.github.io/5G88-editor/findgame/')">
      <img src="https://i.imgur.com/WDjH3BZ.png" alt="icon" class="menu-img"> FIND GAME
    </a>
    <a href="#" onclick="addTab('LINK DOWNLOAD', 'https://searcfile.github.io/5g88-php/linkdownload/')">
      <img src="https://i.imgur.com/WDjH3BZ.png" alt="icon" class="menu-img"> LINK DOWNLOAD
    </a>
    <a href="#" onclick="addTab('MAYBANK', 'https://searcfile.github.io/5G88-editor/maybank/')">
      <img src="https://i.imgur.com/WDjH3BZ.png" alt="icon" class="menu-img"> MAYBANK
    </a>
    <a href="#" onclick="addTab('CIMB BANK', 'https://searcfile.github.io/5g88-php/cimb/')">
      <img src="https://i.imgur.com/WDjH3BZ.png" alt="icon" class="menu-img"> CIMB BANK
    </a>
    <a href="#" onclick="addTab('BANK ISLAM', 'https://searcfile.github.io/5g88-php/bankislam/')">
      <img src="https://i.imgur.com/WDjH3BZ.png" alt="icon" class="menu-img"> BANK ISLAM
    </a>
  </div>

<div class="header">
  <div class="menu-icon" id="menuIcon">☰</div>

  <div style="display: flex; gap: 20px; position: absolute; top: 15px; left: 45px;">
    <!-- LiveChat -->
    <button id="liveChatBtn" class="live-chat-button"
            onclick="addTab('LIVE CHAT','https://searcfile.github.io/5g88-php/userlivechatphp/')"
            aria-label="LiveChat" title="LiveChat">
      <svg width="1.2rem" height="1.2rem" fill="currentColor" viewBox="0 0 24 24" style="margin-right: 1px;">
        <path d="M24 20h-3v4l-5.333-4h-7.667v-4h2v2h6.333l2.667 2v-2h3v-8.001h-2v-2h4v12.001zm-6-6h-9.667l-5.333 4v-4h-3v-14.001h18v14.001zm-9-4.084h-5v1.084h5v-1.084zm5-2.916h-10v1h10v-1zm0-3h-10v1h10v-1z"/>
      </svg>
      <span class="btn-label">LiveChat</span>
      <svg id="livechatDot" class="dot-icon" xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="red" viewBox="0 0 24 24">
        <path d="M12 1c-6.338 0-12 4.226-12 10.007 0 2.05.739 4.063 2.047 5.625.055 1.83-1.023 4.456-1.993 6.368 2.602-.47 6.301-1.508 7.978-2.536 9.236 2.247 15.968-3.405 15.968-9.457 0-5.812-5.701-10.007-12-10.007zm1 15h-2v-6h2v6zm-1-7.75c-.69 0-1.25-.56-1.25-1.25s.56-1.25 1.25-1.25 1.25.56 1.25 1.25-.56 1.25-1.25 1.25z"/>
      </svg>
    </button>

    <!-- LinkDownload -->
    <button id="linkDownloadBtn" class="live-chat-button"
            onclick="addTab('LINK DOWNLOAD','https://searcfile.github.io/5g88-php/linkdownload/')"
            aria-label="Link Download" title="Link Download">
      <svg width="1.2rem" height="1.2rem" fill="currentColor" viewBox="0 0 24 24" style="margin-right: 1px;">
        <path d="M15 10h4l-7 8-7-8h4v-10h6v10zm6 9v5h-18v-5h18zm-6 2h-1v1h1v-1zm2 0h-1v1h1v-1zm2 0h-1v1h1v-1z"/>
      </svg>
      <span class="btn-label">LinkDownload</span>
    </button>

    <!-- GameLog (judul tombol; dropdown di bawahnya tetap sama) -->
    <div class="dropdown-wrapper">
      
      <button id="gameLogBtn" class="live-chat-button" aria-label="Game Log" title="Game Log">
        <svg width="1.2rem" height="1.2rem" fill="currentColor" viewBox="0 0 24 24" style="margin-right: 1px;">
          <path d="m11.25 6c.398 0 .75.352.75.75 0 .414-.336.75-.75.75-1.505 0-7.75 0-7.75 0v12h17v-8.749c0-.414.336-.75.75-.75s.75.336.75.75v9.249c0 .621-.522 1-1 1h-18c-.48 0-1-.379-1-1v-13c0-.481.38-1 1-1zm1.521 9.689 9.012-9.012c.133-.133.217-.329.217-.532 0-.179-.065-.363-.218-.515l-2.423-2.415c-.143-.143-.333-.215-.522-.215s-.378.072-.523.215l-9.027 8.996c-.442 1.371-1.158 3.586-1.264 3.952-.126.433.198.834.572.834.41 0 .696-.099 4.176-1.308zm-2.258-2.392 1.17 1.171c-.704.232-1.274.418-1.729.566zm.968-1.154 7.356-7.331 1.347 1.342-7.346 7.347z"/>
        </svg>
        <span class="btn-label">GameLog</span>
      </button>

      <div id="gameLogDropdown" class="dropdown-links">
        <!-- (isi a href kamu tetap) -->
        <a data-label="MEGA888" href="#" onclick="addTab('MEGA888','https://searcfile.github.io/5G88-editor/mega888/');">
          MEGA888
          <svg class="check-icon" viewBox="0 0 24 24" width="16" height="16" style="display: none;">
            <path fill="currentColor" d="M9 22l-10-10.598 2.798-2.859 7.149 7.473 13.144-14.016 2.909 2.806z"/>
          </svg>
        </a>
        <a data-label="PUSSY888" href="#" onclick="addTab('PUSSY888','https://searcfile.github.io/5G88-editor/pussy888/');">
          PUSSY888
          <svg class="check-icon" viewBox="0 0 24 24" width="16" height="16" style="display: none;">
            <path fill="currentColor" d="M9 22l-10-10.598 2.798-2.859 7.149 7.473 13.144-14.016 2.909 2.806z"/>
          </svg>
        </a>
        <a data-label="918KISS" href="#" onclick="addTab('918KISS','https://searcfile.github.io/5G88-editor/918kiss/');">
          918KISS
          <svg class="check-icon" viewBox="0 0 24 24" width="16" height="16" style="display: none;">
            <path fill="currentColor" d="M9 22l-10-10.598 2.798-2.859 7.149 7.473 13.144-14.016 2.909 2.806z"/>
          </svg>
        </a>
        <a data-label="SCR888H5" href="#" onclick="addTab('SCR888H5','https://searcfile.github.io/5G88-editor/scr888h5/');">
          SCR888H5
          <svg class="check-icon" viewBox="0 0 24 24" width="16" height="16" style="display: none;">
            <path fill="currentColor" d="M9 22l-10-10.598 2.798-2.859 7.149 7.473 13.144-14.016 2.909 2.806z"/>
          </svg>
        </a>
      </div>
    </div>
    <!-- BANK RESIT (copy gaya GameLog) -->
<div class="dropdown-wrapper">
  <button id="bankResitBtn" class="live-chat-button" aria-label="Bank Resit" title="Bank Resit">
    <svg width="1.2rem" height="1.2rem" fill="currentColor" viewBox="0 0 24 24" style="margin-right: 1px;">
      <path d="M12 2l10 6v2h-2v10h-5v-6h-6v6h-5v-10h-2v-2l10-6zm0 2.197l-6.764 4.054h13.528l-6.764-4.054z"/>
    </svg>
    <span class="btn-label">Bank Receipt</span>
  </button>

  <div id="bankResitDropdown" class="dropdown-links">
    <a data-label="MAYBANK" href="#"
       onclick="addTab('MAYBANK','https://searcfile.github.io/5G88-editor/maybank/');">
      MAYBANK
      <svg class="check-icon" viewBox="0 0 24 24" width="16" height="16" style="display:none;">
        <path fill="currentColor" d="M9 22l-10-10.598 2.798-2.859 7.149 7.473 13.144-14.016 2.909 2.806z"/>
      </svg>
    </a>
    <a data-label="CIMB BANK" href="#"
       onclick="addTab('CIMB BANK','https://searcfile.github.io/5g88-php/cimb/');">
      CIMB BANK
      <svg class="check-icon" viewBox="0 0 24 24" width="16" height="16" style="display:none;">
        <path fill="currentColor" d="M9 22l-10-10.598 2.798-2.859 7.149 7.473 13.144-14.016 2.909 2.806z"/>
      </svg>
    </a>
    <a data-label="BANK ISLAM" href="#"
       onclick="addTab('BANK ISLAM','https://searcfile.github.io/5g88-php/bankislam/');">
      BANK ISLAM
      <svg class="check-icon" viewBox="0 0 24 24" width="16" height="16" style="display:none;">
        <path fill="currentColor" d="M9 22l-10-10.598 2.798-2.859 7.149 7.473 13.144-14.016 2.909 2.806z"/>
      </svg>
    </a>
  </div>
</div>
  </div>

  <img src="https://i.imgur.com/QrxyBjc.png" class="floating-logo" alt="Logo 5G88" />

  <div class="user-info">
    <div class="user-text">
      <div style="display: flex; align-items: center; gap: 10px;">
        <div id="notificationBell" style="width: 18px; height: 18px; background-color: red; border-radius: 50%; display: none; justify-content: center; align-items: center; font-size: 12px; color: white; font-weight: bold; cursor: pointer;" title="You have a new message">!</div>

        <div id="notifButton" style="background: #111; border: 1px solid gold; border-radius: 50%; width: 26px; height: 26px; color: gold; display: flex; justify-content: center; align-items: center; cursor: pointer; box-shadow: 0 0 6px rgba(255, 215, 0, 0.4); position: relative; font-size: 14px;">
          🔔
          <span id="notifDot" style="position: absolute; top: 2px; right: 2px; background: red; width: 10px; height: 10px; border-radius: 50%; display: none; border: 1px solid white;"></span>
          <div id="notifTooltip" style="display: none; position: absolute;border: 1px solid #424242; top: 2%; left: calc(100% + 8px); transform: translateX(1%); background: #141414; color: gold; padding: 4px 8px; font-size: 11px; border-radius: 6px; white-space: nowrap; z-index: 10000;">Notice</div>
        </div>

        <div id="dateTime" class="date-time"></div>
      </div>

      <div class="user-dropdown">
        <button id="userName" class="user-button" aria-label="Account" title="Account">
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 12c2.7 0 4.8-2.1 4.8-4.8S14.7 2.4 12 2.4 7.2 4.5 7.2 7.2 9.3 12 12 12zm0 2.4c-3.2 0-9.6 1.6-9.6 4.8V22h19.2v-2.8c0-3.2-6.4-4.8-9.6-4.8z"/>
          </svg>
          <span id="userNameText"></span>
        </button>

        <div id="dropdownContent" class="dropdown-content">
          <div id="userEmail" style="margin-bottom: 8px;"></div>
          <hr style="border: 0; border-top: 1px solid #424242; margin: 8px 0;">
          <button id="menuUserBtn" class="menu-user-btn" type="button" aria-disabled="true"></button>
          <button id="changePwBtn" class="btn-cpw">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right:4px">
              <path d="M10 17c0 .552-.447 1-1 1s-1-.448-1-1 .447-1 1-1 1 .448 1 1zm3 0c0 .552-.447 1-1 1s-1-.448-1-1 .447-1 1-1 1 .448 1 1zm3 0c0 .552-.447 1-1 1s-1-.448-1-1 .447-1 1-1 1 .448 1 1zm2-7v-4c0-3.313-2.687-6-6-6s-6 2.687-6 6v4h-3v14h18v-14h-3zm-10-4c0-2.206 1.795-4 4-4s4 1.794 4 4v4h-8v-4zm11 16h-14v-10h14v10z"/>
            </svg>
            Change Password
          </button>

          <button id="logoutBtn">
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24" style="margin-right: 6px;">
              <path d="M16 10v-5l8 7-8 7v-5h-8v-4h8zm-16-8v20h14v-2h-12v-16h12v-2h-14z"/>
            </svg>
            Logout
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

  <div id="tabBar" class="tab-bar"></div>


  <div class="container" id="mainContainer">
      <div id="emptyState" class="empty-state hidden" role="status" aria-live="polite">
    <h3 class="empty-title">Click menu open sidebar!</h3>
    <svg class="empty-icon" width="64" height="64" viewBox="0 0 24 24" aria-hidden="true">
      <path d="M3 7a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7z"
            fill="none" stroke="currentColor" stroke-width="1.5"/>
      <path d="M3 13h5l2 3h4l2-3h5" fill="none" stroke="currentColor" stroke-width="1.5"/>
    </svg>
    <p class="empty-desc">No data</p>
  </div>
    <div id="iframeLoader" style="position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: rgba(0, 0, 0, 0.55); display: none; align-items: center; justify-content: center; flex-direction: column; z-index: 1000;">
      <img src="https://api.5g88.homes/media/LOADING_GIF.webp" alt="Loading..." style="width: 150px; height: auto;" />
      <div style="margin-top: 1px; color: white; font-size: 14px; font-family: sans-serif;">Loading...</div>
    </div>
    <iframe
  id="pageFrame"
  allow="clipboard-write"
  sandbox="allow-scripts allow-same-origin"
  style="width: 100%; height: calc(100vh - 95px); border: none;">
</iframe>
  </div>


 <div id="messagePopup" style="display: none; position: fixed; top: 0; left: 0;background: #1f1f1f; font-size: 14px; color: rgba(255,255,255,0.85); border: 1px solid #424242; border-radius: 6px; padding: 3px 10px; max-width: 220px; z-index: 9999;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <strong style="color: red;font-size:14px;font-weight: bold;">📢- Announcement!</strong>
      <button onclick="closeMessage()" style="background: none; color: white; border: none; font-size: 18px; cursor: pointer; transition: transform 0.2s, color 0.2s;" 
        onmouseover="this.style.transform='scale(1.3)'; this.style.color='red';"
        onmouseout="this.style.transform='scale(1)'; this.style.color='white';">×</button>
    </div>
    <div id="messageContent" style="margin-top: 2px;font-size:12px; white-space: normal; word-wrap: break-word; overflow-wrap: anywhere;"></div>
  </div>

  <div id="cpModal" role="dialog" aria-modal="true" aria-labelledby="cpTitle">
  <div id="cpDialog">
    <div id="cpHead">
      <div id="cpTitle">Change Password</div>
      <button id="cpClose" aria-label="Close">×</button>
    </div>
    <div id="cpBody">
      <div class="cp-hint">Enter your old password & new password (min 6 characters).</div>
      <div id="cpErr" class="cp-error"></div>
      <div id="cpOk" class="cp-ok"></div>

      <div class="cp-group">
        <label class="cp-label" for="cpOld">Current Password</label>
        <input id="cpOld" type="password" class="cp-input" autocomplete="current-password" />
      </div>
      <div class="cp-group">
        <label class="cp-label" for="cpNew">New Password</label>
        <input id="cpNew" type="password" class="cp-input" autocomplete="new-password" />
      </div>
      <div class="cp-group">
        <label class="cp-label" for="cpNew2">Confirm Password</label>
        <input id="cpNew2" type="password" class="cp-input" autocomplete="new-password" />
      </div>
    </div>
    <div id="cpFoot">
      <button class="cp-btn" id="cpCancel">Cancel</button>
      <button class="cp-btn primary" id="cpSubmit">Change</button>
    </div>
  </div>
</div>
  
<audio id="notifSound" src="https://searcfile.github.io/5G88-audio/notifsound/notification.wav" preload="auto"></audio>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script>window.renderMobileUserBtn = window.renderMobileUserBtn || function(){};</script>
<script>

/*Mcng 112 updated 232131*/
const firebaseConfig = {
  apiKey: "AIzaSyBTeofEXBlzZmELtVAVZ-dctZmOGvf0Y34",
  authDomain: "notice-83ae5.firebaseapp.com",
  databaseURL: "https://notice-83ae5-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "notice-83ae5",
  storageBucket: "notice-83ae5.appspot.com",
  messagingSenderId: "268106877488",
  appId: "1:268106877488:web:798beadfe45104297e7bf5",
  measurementId: "G-8EY4MCZKK2"
};
if (!firebase.apps.length) {
  firebase.initializeApp(firebaseConfig);
}
const db = firebase.database();
const blurphpApp = firebase.initializeApp({
  apiKey: "AIzaSyCKmrlS4qrZCrMNRIfIRCWCbNgZT1uQ3ZI",
  authDomain: "blurphp.firebaseapp.com",
  databaseURL: "https://blurphp-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "blurphp",
  storageBucket: "blurphp.appspot.com",
  messagingSenderId: "593904200464",
  appId: "1:593904200464:web:cea7bc1360532c20d99395",
  measurementId: "G-R494S2DPZ5"
}, "blurphpApp");
const blurphpDb = blurphpApp.database();
const loginApp = firebase.initializeApp({
  apiKey: "AIzaSyCZ9zUxDf3V9TvI3vOdgeZD7pLE4IuPrOE",
  authDomain: "logins-d615f.firebaseapp.com",
  databaseURL: "https://logins-d615f-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "logins-d615f",
  storageBucket: "logins-d615f.appspot.com",
  messagingSenderId: "648022690285",
  appId: "1:648022690285:web:aefad61a2f46e6cf39f05b"
}, "loginApp");
const loginDb = loginApp.database();

(() => {
  try {
    const qs = new URLSearchParams(location.search);
    const name  = qs.get("name");
    const email = qs.get("email");
    const photo = qs.get("photo");
    const validEmail = (e)=> /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e||"");

    if (email && validEmail(decodeURIComponent(email))) {
      localStorage.setItem("gmailLogin", JSON.stringify({
        name:  decodeURIComponent(name || ""),
        email: decodeURIComponent(email).toLowerCase(),
        photo: decodeURIComponent(photo || "")
      }));
      // tanda baru login supaya tidak ping-pong
      sessionStorage.setItem("justLoggedIn", "1");
      history.replaceState({}, document.title, location.origin + location.pathname);
    }
  } catch (_) {}
})();
// === Helper: cek tipe login & update tombol Change Password ===
function isUsernameLoginNow() {
  try {
    const login = JSON.parse(localStorage.getItem('gmailLogin') || '{}');
    const email = (login?.email || '').toLowerCase();
    return email.endsWith('@5g88.local');
  } catch {
    return false;
  }
}

function updateChangePwVisibility() {
  const btn = document.getElementById('changePwBtn');
  if (!btn) return;
  btn.style.display = isUsernameLoginNow() ? 'flex' : 'none';
}
window.addEventListener('load', () => {
  updateChangePwVisibility();
  window.renderMobileUserBtn && window.renderMobileUserBtn();
});
window.addEventListener('storage', (e)=> {
  if (e.key === 'gmailLogin') {
    updateChangePwVisibility();
    window.renderMobileUserBtn && window.renderMobileUserBtn();
  }
});
let userId = "";
// Notifikasi popup atas
const notifButton = document.getElementById("notifButton");
const notifDot = document.getElementById("notifDot");
const popup = document.getElementById("messagePopup");
const content = document.getElementById("messageContent");
const notifTooltip = document.getElementById("notifTooltip");

document.addEventListener("DOMContentLoaded", () => {
  const savedMessage = localStorage.getItem("latestNotifMessage");
  const savedTimestamp = localStorage.getItem("latestNotifTimestamp");

  const cur = JSON.parse(localStorage.getItem("gmailLogin") || "{}");
  const curEmail = (cur.email || "guest").toLowerCase();
  const seenKey = `seenNotif_${savedTimestamp}_${curEmail}`;

  if (savedMessage && savedTimestamp && notifButton) {
    const alreadySeen = localStorage.getItem(seenKey);
    notifButton.dataset.message = savedMessage;
    notifButton.dataset.timestamp = savedTimestamp;
    if (!alreadySeen && notifDot) notifDot.style.display = "block";
  }
});

// Realtime notifikasi pesan baru dari Firebase
db.ref("notifikasi/pesanTerbaru").on("value", (snapshot) => {
  const data = snapshot.val();
  if (!data || !data.message || !data.timestamp) return;
  showNotification(data.message, data.timestamp);
});

function showNotification(message, timestamp) {
  const cur = JSON.parse(localStorage.getItem("gmailLogin") || "{}");
  const curEmail = (cur.email || "guest").toLowerCase();
  const seenKey = `seenNotif_${timestamp}_${curEmail}`;
  const alreadySeen = localStorage.getItem(seenKey);

  if (!alreadySeen && notifButton) {
    notifButton.dataset.message = message;
    notifButton.dataset.timestamp = timestamp;
    localStorage.setItem("latestNotifMessage", message);
    localStorage.setItem("latestNotifTimestamp", timestamp);
    if (notifDot) notifDot.style.display = "block";
  }
}

if (notifButton) {
  notifButton.addEventListener("click", () => {
    const message = notifButton.dataset.message;
    const timestamp = Number(notifButton.dataset.timestamp);
    if (!message || !timestamp) return;

    if (popup.style.display === "block") {
      popup.style.display = "none";
      return;
    }

    const dateObj = new Date(timestamp);
    const isValidDate = !isNaN(dateObj.getTime());

    content.innerHTML = `
      <div>${message}</div>
      <div style="text-align:right;font-size:12px;color:#aaa;margin-top:10px;">
        ${isValidDate ? `
          ${String(dateObj.getDate()).padStart(2,'0')}/
          ${String(dateObj.getMonth()+1).padStart(2,'0')}/
          ${dateObj.getFullYear()} 
          ${String(dateObj.getHours()).padStart(2,'0')}:
          ${String(dateObj.getMinutes()).padStart(2,'0')}:
          ${String(dateObj.getSeconds()).padStart(2,'0')}
        ` : `Waktu tidak valid`}
      </div>
    `;

    popup.style.display = "block";
    setTimeout(() => {
      const rect = notifButton.getBoundingClientRect();
      popup.style.position = "fixed";
      popup.style.top = `${rect.bottom + 4.1}px`;
      popup.style.left = "auto";
      popup.style.right = `${window.innerWidth - rect.right}px`;
    }, 0);

    if (notifDot) notifDot.style.display = "none";
    const cur = JSON.parse(localStorage.getItem("gmailLogin") || "{}");
    const curEmail = (cur.email || "guest").toLowerCase();
    const seenKey = `seenNotif_${timestamp}_${curEmail}`;
    localStorage.setItem(seenKey, "1");
  });

  notifButton.addEventListener("mouseenter", () => {
    if (notifTooltip) notifTooltip.style.display = "block";
  });
  notifButton.addEventListener("mouseleave", () => {
    if (notifTooltip) notifTooltip.style.display = "none";
  });
}

// Klik luar = tutup popup (biarkan seperti punyamu)
document.addEventListener("click", function (event) {
  if (popup && popup.style.display === "block" && !popup.contains(event.target) && !notifButton?.contains(event.target)) {
    popup.style.display = "none";
  }
});
window.addEventListener("blur", () => {
  if (popup && popup.style.display === "block") {
    popup.style.display = "none";
  }
});
// ===== DROPDOWNS (GameLog & Bank Resit) – versi terpadu =====
const gameLogBtn        = document.getElementById("gameLogBtn");
const gameLogDropdown   = document.getElementById("gameLogDropdown");
const bankResitBtn      = document.getElementById("bankResitBtn");
const bankResitDropdown = document.getElementById("bankResitDropdown");

function closeAllDropdowns() {
  if (gameLogDropdown)   gameLogDropdown.style.display   = "none";
  if (bankResitDropdown) bankResitDropdown.style.display = "none";
}

function toggleDropdown(btnEl, ddEl) {
  if (!btnEl || !ddEl) return;
  const rect = btnEl.getBoundingClientRect();
  const willOpen = ddEl.style.display !== "block";

  // Tutup semua sebelum buka salah satu
  closeAllDropdowns();

  if (willOpen) {
    ddEl.style.left = `${rect.left}px`;
    ddEl.style.top  = `${rect.bottom + 6}px`;
    ddEl.style.display = "block";
  }
}

// Klik tombol -> toggle & tutup yang lain otomatis
gameLogBtn?.addEventListener("click", (e) => {
  e.stopPropagation();
  toggleDropdown(gameLogBtn, gameLogDropdown);
});

bankResitBtn?.addEventListener("click", (e) => {
  e.stopPropagation();
  toggleDropdown(bankResitBtn, bankResitDropdown);
});

// Klik di luar -> tutup semua dropdown
document.addEventListener("click", () => closeAllDropdowns());

const pageFrame = document.getElementById("pageFrame");
if (pageFrame) {
  pageFrame.addEventListener("load", () => {
    try {
      pageFrame.contentWindow.document.addEventListener("click", closeAllDropdowns);
    } catch (_) {}

    const origin = getChildOriginFromSrc(pageFrame.src);
    if (origin) {
      sendLoginToIframeReliable(pageFrame, 6, 200, origin);
      setTimeout(() => sendLoginToIframeReliable(pageFrame, 6, 250, origin), 800);
    }
  });
}
// Blur/ESC -> tutup semuanya
window.addEventListener("blur", closeAllDropdowns);
window.addEventListener("keydown", (e) => { if (e.key === "Escape") closeAllDropdowns(); });
function closeMessage() {
  const popup = document.getElementById("messagePopup");
  if (popup) popup.style.display = "none";
}
const tabBar = document.getElementById("tabBar");
const menuIcon = document.getElementById("menuIcon");
const sidebar = document.getElementById("sidebar");
const overlay = document.getElementById("overlay");
const container = document.getElementById("mainContainer");

if (tabBar) {
  tabBar.style.display = "flex";
  tabBar.style.alignItems = "center";
  tabBar.style.padding = "10px 2px";
  tabBar.style.background = "#000";
}


menuIcon.addEventListener("click", () => {
  if (sidebar.classList.contains("active")) {
    closeSidebar();
  } else {
    openSidebar();
  }
});
overlay.addEventListener("click", closeSidebar);
function openSidebar() {
  sidebar.classList.add("active");
  overlay.classList.add("active");
  container.classList.add("shrink");
  document.querySelector(".floating-logo").classList.add("shrink");
  document.querySelector('.header').classList.add('shrink');
  document.getElementById("tabBar").classList.add('shrink');
  document.getElementById("menuIcon").classList.add("active-menu-icon");
}

function closeSidebar() {
  sidebar.classList.remove("active");
  overlay.classList.remove("active");
  container.classList.remove("shrink");
  document.querySelector(".floating-logo").classList.remove("shrink");
  document.querySelector('.header').classList.remove('shrink');
  document.getElementById("tabBar").classList.remove('shrink');
  document.getElementById("menuIcon").classList.remove("active-menu-icon");
}

document.addEventListener("click", (e) => {
  const isSidebar = e.target.closest("#sidebar");
  const isMenuIcon = e.target.closest("#menuIcon");

  if (!isSidebar && !isMenuIcon && sidebar.classList.contains("active")) {
    closeSidebar();
  }
});
function saveTabs(tabs) {
  localStorage.setItem("openTabs", JSON.stringify(tabs));
}
function getTabs() {
  return JSON.parse(localStorage.getItem("openTabs")) || [];
}
const emptyState = document.getElementById('emptyState');
function updateEmptyState(){
  if (!emptyState) return;
  const tabs = getTabs();
  if (tabs.length === 0) emptyState.classList.remove('hidden');
  else emptyState.classList.add('hidden');
}

function addTab(label, url) {
  const existingTabs = getTabs();
  const exists = existingTabs.some(tab => tab.label === label);
  if (!exists) {
    existingTabs.push({ label, url });
    saveTabs(existingTabs);
  }
  
  const linkBtn = document.getElementById("linkDownloadBtn");
  const liveBtn = document.getElementById("liveChatBtn");
  const liveDot = document.getElementById("livechatDot");
  const gameLogBtn = document.getElementById("gameLogBtn");
  const bankResitBtnEl = document.getElementById("bankResitBtn");

  if (gameLogBtn) {
    const gameLogLabels = ["MEGA888", "PUSSY888", "918KISS", "SCR888H5"];
    if (gameLogLabels.includes(label)) {
      gameLogBtn.classList.add("active-gamelog");
    } else {
      gameLogBtn.classList.remove("active-gamelog");
    }
  }
  if (bankResitBtnEl) {
  const bankResitLabels = ["MAYBANK", "CIMB BANK","BANK ISLAM"];
  if (bankResitLabels.includes(label)) {
    bankResitBtnEl.classList.add("active-gamelog"); // reuse class biar gaya sama
  } else {
    bankResitBtnEl.classList.remove("active-gamelog");
  }
}

  if (liveBtn) {
    if (label === "LIVE CHAT") {
      liveBtn.classList.add("active-livechat");
      if (liveDot) liveDot.style.display = "none";

      // Tandai semua pesan admin sebagai sudah dibaca
      markLivechatAsRead();
    } else {
      liveBtn.classList.remove("active-livechat");
    }
  }

  if (linkBtn) {
    if (label === "LINK DOWNLOAD") {
      linkBtn.classList.add("active-linkdownload");
    } else {
      linkBtn.classList.remove("active-linkdownload");
    }
  }

  loadPage(url);
  renderTabs();
  updateGameLogCheckmarks();
  updateBankResitCheckmarks();
  updateEmptyState();
}

// === Kirim login ke iframe secara andal dgn retries + delay ===
function getLoginPayload() {
  const u = JSON.parse(localStorage.getItem("gmailLogin") || "{}");
  if (!u?.email) return null;
  return {
    type: "user-login",
    user: { name: u.name || "", email: u.email, photo: u.photo || "" }
  };
}
function getChildOriginFromSrc(src){
  try {
    const u = new URL(src);
    if (u.protocol === 'https:' || u.protocol === 'http:') return u.origin;
  } catch(_) {}
  return null; // << jangan fallback ke domain lain
}
function sendLoginToIframeReliable(iframe, tries=10, gap=250, forceOrigin=null){
  if (!iframe || !iframe.contentWindow) return;
  const payload = getLoginPayload();
  if (!payload) return;

  if (iframe._loginTicker) clearInterval(iframe._loginTicker);
  let count = 0;

  iframe._loginTicker = setInterval(() => {
    if (count++ >= tries) { clearInterval(iframe._loginTicker); iframe._loginTicker=null; return; }
    const origin = forceOrigin || getChildOriginFromSrc(iframe.src);
    if (!origin) return;
    try { iframe.contentWindow.postMessage(payload, origin); } catch(_) {}
  }, gap);
}

// 🔁 Jalankan saat tab LiveChat diklik — pakai fungsi RELIABLE
const liveChatBtn = document.getElementById("liveChatBtn");
if (liveChatBtn) {
  liveChatBtn.addEventListener("click", () => {
    setTimeout(() => {
      const frame = document.getElementById("pageFrame");
      if (frame) sendLoginToIframeReliable(frame, 8, 200);
    }, 250);
  });
}
function closeTab(label) {
  let tabs = getTabs().filter(tab => tab.label !== label);
  saveTabs(tabs);
  renderTabs();
  updateGameLogCheckmarks();
  updateBankResitCheckmarks();
  updateEmptyState();

  const gameLogBtn = document.getElementById("gameLogBtn");
  const liveBtn = document.getElementById("liveChatBtn");
  const linkBtn = document.getElementById("linkDownloadBtn");
  const bankResitBtnEl = document.getElementById("bankResitBtn");

  if (tabs.length > 0) {
    const lastTab = tabs[tabs.length - 1];
    loadPage(lastTab.url);

    // Set status aktif tombol sesuai tab terakhir
    const gameLogLabels = ["MEGA888", "PUSSY888", "918KISS", "SCR888H5"];
    const bankResitLabels = ["MAYBANK", "CIMB BANK","BANK ISLAM"];

    gameLogBtn?.classList.toggle("active-gamelog", gameLogLabels.includes(lastTab.label));
    bankResitBtnEl?.classList.toggle("active-gamelog", bankResitLabels.includes(lastTab.label));
    liveBtn?.classList.toggle("active-livechat", lastTab.label === "LIVE CHAT");
    linkBtn?.classList.toggle("active-linkdownload", lastTab.label === "LINK DOWNLOAD");
  } else {
    // Tidak ada tab tersisa → matikan semua status aktif
    pageFrame.src = "";
    gameLogBtn?.classList.remove("active-gamelog");
    bankResitBtnEl?.classList.remove("active-gamelog");
    liveBtn?.classList.remove("active-livechat");
    linkBtn?.classList.remove("active-linkdownload");
  }
}
 
function renderTabs() {
  tabBar.innerHTML = "";
  const tabs = getTabs();

  tabs.forEach((tab, index) => {
    const tabElement = document.createElement("div");
    tabElement.className = "tab";
    tabElement.dataset.index = index;

    // Style
    tabElement.style.background = "rgba(255, 255, 255, 0.04)";
    tabElement.style.color = "rgba(255, 255, 255, 0.85)";
    tabElement.style.padding = "6px 16px";
    tabElement.style.marginRight = "0px";
    tabElement.style.borderRadius = "6px";
    tabElement.style.border = "1px solid #303030";
    tabElement.style.display = "inline-flex";
    tabElement.style.alignItems = "center";
    tabElement.style.fontSize = "14px";
    tabElement.style.userSelect = "none";
    tabElement.style.cursor = "pointer";

    // Klik efek
    tabElement.addEventListener("mousedown", () => {
      tabElement.style.filter = "brightness(0.7)";
    });
    tabElement.addEventListener("mouseup", () => {
      tabElement.style.filter = "none";
    });
    tabElement.addEventListener("mouseleave", () => {
      tabElement.style.filter = "none";
    });

    // Klik tab → buka page
    tabElement.onclick = () => {
      loadPage(tab.url);

      const gameLogBtn = document.getElementById("gameLogBtn");
      const liveBtn = document.getElementById("liveChatBtn");
      const linkBtn = document.getElementById("linkDownloadBtn");
      const bankResitBtnEl = document.getElementById("bankResitBtn");

      if (liveBtn)
        liveBtn.classList.toggle("active-livechat", tab.label === "LIVE CHAT");

      if (linkBtn)
        linkBtn.classList.toggle("active-linkdownload", tab.label === "LINK DOWNLOAD");

      if (gameLogBtn) {
        const gameLogLabels = ["MEGA888", "PUSSY888", "918KISS", "SCR888H5"];
        gameLogBtn.classList.toggle("active-gamelog", gameLogLabels.includes(tab.label));
      }
      if (bankResitBtnEl) {
      const bankResitLabels = ["MAYBANK", "CIMB BANK","BANK ISLAM"];
      bankResitBtnEl.classList.toggle("active-gamelog", bankResitLabels.includes(tab.label));
      }
    };
   
    // Tab aktif highlight
    const currentFrame = document.getElementById("pageFrame");
    if (currentFrame && tab.url === currentFrame.src) {
      tabElement.classList.add("active-tab");
    }

    const title = document.createElement("span");
    title.textContent = tab.label;
    title.style.pointerEvents = "none";

    const closeBtn = document.createElement("button");
    closeBtn.className = "close-tab";
    closeBtn.textContent = "×";
    closeBtn.style.marginLeft = "4px";
    closeBtn.style.cursor = "pointer";
    closeBtn.style.background = "none";
    closeBtn.style.border = "none";
    closeBtn.style.color = "red";
    closeBtn.style.fontSize = "14px";
    closeBtn.style.transition = "all 0.2s ease";
    closeBtn.style.padding = "0";
    closeBtn.style.pointerEvents = "auto";

    closeBtn.onmouseover = () => {
      closeBtn.style.color = "#ff1a1a";
      closeBtn.style.transform = "scale(1.15)";
    };
    closeBtn.onmouseout = () => {
      closeBtn.style.color = "red";
    };
    closeBtn.onclick = (e) => {
      e.stopPropagation();
      closeTab(tab.label);
    };

    tabElement.appendChild(title);
    tabElement.appendChild(closeBtn);
    tabBar.appendChild(tabElement);
  });

  // Inisialisasi Sortable.js drag (auto spacing)
  initSortableTabs();
  updateGameLogCheckmarks();
  updateBankResitCheckmarks();
}
function initSortableTabs() {
  if (!window.Sortable || !tabBar) return;

  // Destroy instance sebelumnya jika ada
  if (tabBar._sortable) {
    tabBar._sortable.destroy();
  }

  // Buat baru & simpan ke properti _sortable
  tabBar._sortable = Sortable.create(tabBar, {
    animation: 200,
    ghostClass: "dragging",
    onEnd: function (evt) {
      const tabs = getTabs();
      const [movedTab] = tabs.splice(evt.oldIndex, 1);
      tabs.splice(evt.newIndex, 0, movedTab);
      saveTabs(tabs);
      renderTabs(); // akan auto-panggil initSortableTabs()
    }
  });
}
function loadPage(url) {
  if (emptyState) emptyState.classList.add('hidden');
  const iframeLoader = document.getElementById("iframeLoader");
  const frame = document.getElementById("pageFrame");

  if (!frame) return;

  iframeLoader.style.display = "flex";

  frame.onload = () => {
    iframeLoader.style.display = "none";
  };

  frame.src = url;
  localStorage.setItem("activeTabUrl", url);
  closeSidebar();

  document.querySelectorAll(".tab").forEach(tab => {
    tab.classList.remove("active-tab");
  });

  const tabs = getTabs();
  const tabElements = document.querySelectorAll(".tab");
  tabs.forEach((tab, index) => {
    if (tab.url === url) {
      if (tabElements[index]) {
        tabElements[index].classList.add("active-tab");
      }
    }
  });
}

  // Ceklis GameLog Dropdown
function updateGameLogCheckmarks() {
  const tabs = getTabs();
  const labelsOpen = tabs.map(tab => tab.label);
  const dropdownLinks = document.querySelectorAll('#gameLogDropdown a');

  dropdownLinks.forEach(link => {
    const label = link.getAttribute("data-label");
    const icon = link.querySelector(".check-icon");
     if (labelsOpen.includes(label)) {
     link.classList.add("tab-open");
     icon.style.display = "inline";
     } else {
     link.classList.remove("tab-open");
     icon.style.display = "none";
    }
  });
}
function updateBankResitCheckmarks() {
  const tabs = getTabs();
  const labelsOpen = tabs.map(tab => tab.label);
  const dropdownLinks = document.querySelectorAll('#bankResitDropdown a');

  dropdownLinks.forEach(link => {
    const label = link.getAttribute("data-label");
    const icon = link.querySelector(".check-icon");
    if (labelsOpen.includes(label)) {
      link.classList.add("tab-open");
      if (icon) icon.style.display = "inline";
    } else {
      link.classList.remove("tab-open");
      if (icon) icon.style.display = "none";
    }
  });
}

window.addEventListener("load", () => {
  renderTabs();
  const tabs = getTabs();
  updateEmptyState();
  updateGameLogCheckmarks();
  const activeUrl = localStorage.getItem("activeTabUrl");
  const match = tabs.find(tab => tab.url === activeUrl);

  const liveBtn = document.getElementById("liveChatBtn");
  const linkBtn = document.getElementById("linkDownloadBtn");
  const gameLogBtn = document.getElementById("gameLogBtn");
  const bankResitBtnEl = document.getElementById("bankResitBtn");

  if (liveBtn) liveBtn.classList.remove("active-livechat");
  if (linkBtn) linkBtn.classList.remove("active-linkdownload");
  if (gameLogBtn) gameLogBtn.classList.remove("active-gamelog");
  if (bankResitBtnEl) bankResitBtnEl.classList.remove("active-gamelog");

  if (match) {
    loadPage(match.url);
    updateGameLogCheckmarks();
    updateBankResitCheckmarks();
    updateEmptyState();
    
    if (match.label === "LIVE CHAT") {
      liveBtn.classList.add("active-livechat");
    }

    if (match.label === "LINK DOWNLOAD") {
      linkBtn.classList.add("active-linkdownload");
    }
    const bankResitLabels = ["MAYBANK", "CIMB BANK","BANK ISLAM"];
if (bankResitBtnEl && match && bankResitLabels.includes(match.label)) {
  bankResitBtnEl.classList.add("active-gamelog");
}
    const gameLogLabels = ["MEGA888", "PUSSY888", "918KISS", "SCR888H5"];
    if (gameLogBtn && gameLogLabels.includes(match.label)) {
      gameLogBtn.classList.add("active-gamelog");
    }
  } else if (tabs.length > 0) {
    loadPage(tabs[tabs.length - 1].url);
  }
});

const encodedAdmins = ["YWRtaW4xQGdtYWlsLmNvbQ==","NWc4OC5vZmZpY2FsQGdtYWlsLmNvbQ=="];
const _0xadmins = encodedAdmins.map(e => atob(e));
const allowedAdmins = [..._0xadmins, "admin@example.com"];

function formatTimestamp(date) {
  const y = date.getFullYear();
  const m = String(date.getMonth() + 1).padStart(2, '0');
  const d = String(date.getDate()).padStart(2, '0');
  const hh = String(date.getHours()).padStart(2, '0');
  const mm = String(date.getMinutes()).padStart(2, '0');
  const ss = String(date.getSeconds()).padStart(2, '0');
  return `${y}-${m}-${d} ${hh}:${mm}:${ss}`;
}

function cleanUrl() {
  const cleanUrl = window.location.origin + window.location.pathname;
  window.history.replaceState({}, document.title, cleanUrl);
}

function isValidEmail(email) {
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}

function checkLogin() {
  if (localStorage.getItem("gmailLogin")) return true;
  if (sessionStorage.getItem("justLoggedIn") === "1") {
    setTimeout(() => {
      sessionStorage.removeItem("justLoggedIn");
      location.reload();
    }, 30);
    return false;
  }

  const returnTo = encodeURIComponent(location.href);
  location.replace(`https://5g88-login.vercel.app/?redirect=${returnTo}`);
  return false;
}
function initLivechatNotifListener(userIdParam) {
  const login = JSON.parse(localStorage.getItem("gmailLogin") || "{}");
  if (!login?.email || !userIdParam) return;

  blurphpDb.ref("chats/" + userIdParam).on("value", (snapshot) => {
    let hasUnread = false;
    snapshot.forEach((child) => {
      const msg = child.val();
      if (msg.from === "admin" && msg.seenByUser !== true) {
        hasUnread = true;
      }
    });
    const livechatDot = document.getElementById("livechatDot");
    if (livechatDot) livechatDot.style.display = hasUnread ? "inline" : "none";
  });
}

function markLivechatAsRead() {
  const cur = JSON.parse(localStorage.getItem("gmailLogin") || "{}");
  if (!cur?.email || !userId) return;

  const chatRef = blurphpDb.ref("chats/" + userId);
  chatRef.once("value", (snapshot) => {
    snapshot.forEach((child) => {
      const v = child.val();
      if (v?.from === "admin" && v?.seenByUser !== true) {
        child.ref.update({ seenByUser: true });
      }
    });
  });
}
document.addEventListener("DOMContentLoaded", () => {
  const forceLogout = sessionStorage.getItem("forceLogout");
  if (forceLogout === "1") {
    sessionStorage.removeItem("forceLogout");
    cleanUrl();
  }
  updateChangePwVisibility();
  if (!checkLogin()) return;

const loginDataRaw = localStorage.getItem("gmailLogin");
let sessionData = null;

try {
  sessionData = JSON.parse(loginDataRaw);
} catch (e) {
  console.error("❌ Failed to parse login data:", e);
  localStorage.removeItem("gmailLogin");
  window.location.href = "https://5g88-login.vercel.app/";
  return;
}

if (!sessionData || !sessionData.email) {
  window.location.href = "https://5g88-login.vercel.app/";
  return;
}

userId = (sessionData.email || '').toLowerCase().replace(/\./g, '_');
let lastOverrideTs = 0;
let loginAuth = null;
try { loginAuth = loginApp.auth(); } catch (_) {}
const myOverrideRef = loginDb.ref('logins/admin_override/' + userId);
let lastAt = 0;

myOverrideRef.on('value', async (snap) => {
  const v = snap.val();
  console.log('[override:me]', v);
  if (!v || v.forceLogout !== true) return;
  if (v.at && v.at <= lastAt) return;
  lastAt = v.at || Date.now();

  // (opsional) sign out auth kalau ada
  try { loginApp.auth && (await loginApp.auth().signOut()); } catch (_) {}

  // bersihkan sesi lokal
  localStorage.removeItem('gmailLogin');
  sessionStorage.setItem('forceLogout', '1');
  if (window.google?.accounts?.id) {
    try { google.accounts.id.disableAutoSelect(); } catch (_) {}
  }

  // HAPUS HANYA node saya sendiri, JANGAN root admin_override
  myOverrideRef.remove().catch(()=>{});

  // redirect ke login
  window.location.href = 'https://5g88-login.vercel.app/';
});
loginDb.ref(`logins/blocked_users/${userId}`).on("value", async (s) => {
  if (s.val() === true) {
    try { if (loginAuth) await loginAuth.signOut(); } catch(_) {}
    localStorage.removeItem("gmailLogin");
    if (window.google?.accounts?.id) {
      try { google.accounts.id.disableAutoSelect(); } catch(_) {}
    }
    window.location.href = "https://5g88-login.vercel.app/?blocked=1";
  }
});
  //  Simpan data login ke Firebase -> untuk admin bisa lihat siapa yang sudah login
const sanitizedEmail = sessionData.email.toLowerCase().replace(/\./g, '_');
blurphpDb.ref('users/' + sanitizedEmail).update({
  name: sessionData.name,
  email: sessionData.email,
  photoURL: sessionData.photo || '',
  lastLoginTime: Date.now()
});

// Tambah status online user di Firebase
const connectedRef = blurphpDb.ref(".info/connected");
const onlineRef = blurphpDb.ref("users/" + sanitizedEmail + "/online");

connectedRef.on("value", (snap) => {
  if (snap.val() === true) {
    onlineRef.set(true);
    onlineRef.onDisconnect().set(false);
  }
});

window.addEventListener("beforeunload", () => {
  // set offline
  try {
    blurphpDb.ref("users/" + sanitizedEmail + "/online").set(false);
  } catch (_) {}

  // matikan semua listener yang kita hidupkan
  try {
    blurphpDb.ref("chats/" + userId).off();
  } catch (_) {}

  try {
    loginDb.ref("logins/admin_override/" + userId).off();
  } catch (_) {}
});
let lastNotifTime = 0;
let userHasInteracted = false;
document.body.addEventListener("click", () => { userHasInteracted = true; });

const chatsRef = blurphpDb.ref("chats/" + userId);
chatsRef.off("child_added"); // pastikan gak dobel
chatsRef.on("child_added", (snapshot) => {
  const msg = snapshot.val();
  const livechatDot = document.getElementById("livechatDot");
  const notifSound  = document.getElementById("notifSound");
  if (!msg || msg.from !== "admin") return;

  const timestamp = msg.time || Date.now();
  if (timestamp > lastNotifTime) {
    lastNotifTime = timestamp;
    if (livechatDot) livechatDot.style.display = "inline";

    // guard aman buat audio:
    if (notifSound && userHasInteracted && typeof notifSound.play === "function") {
      notifSound.currentTime = 0;
      notifSound.play().catch(() => {});
    }
  }
});

// indikator unread (pakai fungsi yang sudah kamu buat)
initLivechatNotifListener(userId);
 //Setelah login aman, baru lanjut
  const userNameText = document.getElementById("userNameText");
  const dropdownContent = document.getElementById("dropdownContent");
  const userEmailElem = document.getElementById("userEmail");
  const dropdownWrapper = document.querySelector(".user-dropdown");
  const userButton = document.getElementById("userName");

  if (userNameText && dropdownContent && dropdownWrapper && userButton) {
    const loginData = JSON.parse(localStorage.getItem("gmailLogin"));
    const nameParts = loginData.name.trim().split(" ");
    const displayName = (nameParts.length >= 2 && nameParts[0].toLowerCase() === nameParts[1].toLowerCase())
      ? nameParts[0]
      : loginData.name;
    userNameText.textContent = displayName;
    if (userEmailElem) userEmailElem.textContent = loginData.email;
    window.renderMobileUserBtn && window.renderMobileUserBtn();
    updateChangePwVisibility();
    // 1. Hover: tampilkan dropdown
    dropdownWrapper.addEventListener("mouseenter", () => {
      dropdownContent.style.display = "block";
    });

    // 2. Hover keluar: sembunyikan jika belum diklik
   dropdownWrapper.addEventListener("mouseleave", () => {
  // Jika sedang force-open (hasil dari klik), biarkan tetap tampil
  if (dropdownWrapper.classList.contains("force-open")) return;

  // Kalau bukan dari klik, artinya hanya hover → tutup dropdown
  dropdownContent.style.display = "none";
  userButton.classList.remove("active-user-button");
});

    // 3. Klik user button = toggle tampil dan class
   userButton.addEventListener("click", (e) => {
  e.stopPropagation(); // 🛑 ini bantu cegah konflik click luar
  const isOpen = dropdownWrapper.classList.toggle("force-open");
  dropdownContent.style.display = isOpen ? "block" : "none";
  userButton.classList.toggle("active-user-button", isOpen);
});

    // 4. Klik di luar dropdown → tutup semua
   document.addEventListener("click", (e) => {
  if (!dropdownWrapper.contains(e.target)) {
    dropdownContent.style.display = "none";
    dropdownWrapper.classList.remove("force-open");
    userButton.classList.remove("active-user-button");
  }
});
  }

const logoutBtn = document.getElementById("logoutBtn");
if (logoutBtn) {
  logoutBtn.addEventListener("click", () => {
    localStorage.removeItem("gmailLogin");
    sessionStorage.setItem("forceLogout", "1");
    if (window.google?.accounts?.id) {
      google.accounts.id.disableAutoSelect();
    }
    window.location.href = "https://5g88-login.vercel.app/";
  });
}
window.renderMobileUserBtn = function renderMobileUserBtn(){ 
  const btn = document.getElementById('menuUserBtn');
  if (!btn) return;
  let login, label = 'User';
  try {
    login = JSON.parse(localStorage.getItem('gmailLogin') || '{}');
    const fullName = (login?.name || '').trim();
    const parts = fullName.split(' ').filter(Boolean);
    const dedupName = (parts.length >= 2 && parts[0].toLowerCase() === parts[1].toLowerCase())
      ? parts[0]
      : fullName;
    label = dedupName || (login?.email ? login.email.split('@')[0] : 'User');
  } catch(_){}
  btn.innerHTML = `
    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" style="margin-right:6px">
      <path d="M12 12c2.7 0 4.8-2.1 4.8-4.8S14.7 2.4 12 2.4 7.2 4.5 7.2 7.2 9.3 12 12 12zm0 2.4c-3.2 0-9.6 1.6-9.6 4.8V22h19.2v-2.8c0-3.2-6.4-4.8-9.6-4.8z"/>
    </svg>
    <span>${label}</span>
  `;
};
(function setAriaLabels(){
  const pairs = [
    ['bankResitBtn','Bank Resit'],
    ['liveChatBtn','LiveChat'],
    ['linkDownloadBtn','Link Download'],
    ['gameLogBtn','Game Log'],
    ['userName','Account'],
  ];
  pairs.forEach(([id,label])=>{
    const el = document.getElementById(id);
    if (el){ el.setAttribute('aria-label', label); el.title = label; }
  });
})();
function updateDateTime() {
  const now = new Date();
  const hours = String(now.getHours()).padStart(2, '0');
  const minutes = String(now.getMinutes()).padStart(2, '0');
  const seconds = String(now.getSeconds()).padStart(2, '0');
  const day = String(now.getDate()).padStart(2, '0');
  const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
  const month = monthNames[now.getMonth()];
  const year = now.getFullYear();
  const timeString = `${hours}:${minutes}:${seconds} ${day} ${month} ${year}`;
  document.getElementById('dateTime').textContent = timeString;
}
setInterval(updateDateTime, 1000);
updateDateTime();
// ✅ SATU handler postMessage gabungan (aman & rapi)
window.addEventListener("message", async (e) => {
  const allowedOrigins = new Set([
    "https://searcfile.github.io",
    "https://5g88-main.vercel.app",
  ]);
  if (!allowedOrigins.has(e.origin)) {
    console.warn("❌ Diterima dari origin tidak dibenarkan:", e.origin);
    return;
  }

  // pastikan pesan benar-benar dari iframe kita
  const frame = document.getElementById("pageFrame");
  if (!frame || e.source !== frame.contentWindow) return;

  const data = e.data || {};

  // 1) Handshake login
if (data.type === "child-ready" || data.type === "request-login") {
  const payload = getLoginPayload();
  if (payload) e.source.postMessage(payload, e.origin);  // balas langsung ke origin pengirim
  try { sendLoginToIframeReliable(frame, 4, 200, e.origin); } catch(_) {}
  return;
}

  // 2) Aksi lain
  const livechatDot = document.getElementById("livechatDot");
  if (data.action === "show-livechat-notif" && livechatDot) { livechatDot.style.display = "block"; return; }
  if (data.action === "hide-livechat-notif" && livechatDot) { livechatDot.style.display = "none";  return; }

  // Fallback salin gambar bila ClipboardItem tidak didukung
  async function copyBlobFrom(urlOrData) {
    const resp = await fetch(urlOrData);
    const blob = await resp.blob();

    if (window.ClipboardItem && navigator.clipboard?.write) {
      const item = new ClipboardItem({ [blob.type]: blob });
      await navigator.clipboard.write([item]);
    } else if (navigator.clipboard?.writeText) {
      await navigator.clipboard.writeText(urlOrData);
      alert("Browser tidak mendukung salin gambar langsung. URL gambar telah disalin.");
    } else {
      alert("Clipboard API tidak didukung di browser ini.");
    }
  }

  if (data.action === "copy-image-base64" && data.base64) {
    try { await copyBlobFrom(data.base64); console.log("✅ Gambar (base64) disalin."); }
    catch (err) { console.error("❌ Gagal:", err); alert("❌ Gagal salin gambar."); }
    return;
  }

  if (data.action === "copy-image" && data.url) {
    try { await copyBlobFrom(data.url); console.log("✅ Gambar (URL) disalin."); }
    catch (err) { console.error("❌ Gagal:", err); }
    return;
  }
});

  const loadingScreen = document.getElementById("loadingScreen");
  if (loadingScreen) {
    loadingScreen.style.display = "none";
  }
let isDown = false;
let startX, scrollLeft;

tabBar.addEventListener('mousedown', (e) => {
  isDown = true;
  startX = e.pageX - tabBar.offsetLeft;
  scrollLeft = tabBar.scrollLeft;
});

tabBar.addEventListener('mouseleave', () => {
  isDown = false;
});

tabBar.addEventListener('mouseup', () => {
  isDown = false;
});

tabBar.addEventListener('mousemove', (e) => {
  if (!isDown) return;
  e.preventDefault();
  const x = e.pageX - tabBar.offsetLeft;
  const walk = (x - startX) * 1.5;
  tabBar.scrollLeft = scrollLeft - walk;
});
tabBar.addEventListener('wheel', (e) => {
  if (e.deltaY !== 0) {
    e.preventDefault();
    tabBar.scrollLeft += e.deltaY;
  }
});
});
(function(){
  const btn = document.getElementById('changePwBtn');
  if (!btn) return;

  // set state awal secara dinamis
  updateChangePwVisibility();

  // Elemen modal
  const modal   = document.getElementById('cpModal');
  const closeX  = document.getElementById('cpClose');
  const cancel  = document.getElementById('cpCancel');
  const submit  = document.getElementById('cpSubmit');
  const inOld   = document.getElementById('cpOld');
  const inNew   = document.getElementById('cpNew');
  const inNew2  = document.getElementById('cpNew2');
  const errBox  = document.getElementById('cpErr');
  const okBox   = document.getElementById('cpOk');

  function openCp(){
    // cek ulang status login SAAT INI (bukan nilai lama)
    if (!isUsernameLoginNow()) return;
    errBox.style.display = 'none'; errBox.textContent = '';
    okBox.style.display  = 'none'; okBox.textContent  = '';
    inOld.value = inNew.value = inNew2.value = '';
    modal.style.display = 'flex';
    setTimeout(()=>inOld.focus(), 0);
  }
  function closeCp(){ modal.style.display = 'none'; }
  function showErr(msg){ errBox.textContent = msg; errBox.style.display='block'; okBox.style.display='none'; }
  function showOk(msg){  okBox.textContent  = msg; okBox.style.display='block'; errBox.style.display='none'; }

  btn.addEventListener('click', openCp);
  closeX.addEventListener('click', closeCp);
  cancel.addEventListener('click', closeCp);
  window.addEventListener('click', (e)=>{ if(e.target === modal) closeCp(); });

  async function doChange(){
    const oldPw = inOld.value.trim();
    const newPw = inNew.value.trim();
    const newPw2= inNew2.value.trim();

    if (!oldPw || !newPw || !newPw2) { showErr('All fields are required to be filled in.'); return; }
    if (newPw.length < 6)            { showErr('New password must be at least 6 characters.'); return; }
    if (newPw !== newPw2)            { showErr('Confirm password does not match.'); return; }

    try{
      const login = JSON.parse(localStorage.getItem('gmailLogin') || '{}');
      const email = (login?.email || '').toLowerCase();

      const auth = loginApp.auth();
      await auth.signInWithEmailAndPassword(email, oldPw); // re-auth
      const user = auth.currentUser;
      if (!user) throw new Error('Unable to get active user.');

      await user.updatePassword(newPw);

      showOk('Password changed successfully ✅');
      setTimeout(closeCp, 1200);
    }catch(err){
      const code = err?.code || '';
      if (code === 'auth/wrong-password') showErr('Wrong current password.');
      else if (code === 'auth/user-not-found') showErr('Username does not exist.');
      else if (code === 'auth/too-many-requests') showErr('Too many attempts. Please try again later.');
      else showErr('Gagal mengubah password. ' + (err?.message || ''));
    }
  }
  submit.addEventListener('click', doChange);
  [inOld,inNew,inNew2].forEach(i=>i.addEventListener('keydown',(e)=>{ if(e.key==='Enter') doChange(); }));
})();
</script>
</body>
</html>
